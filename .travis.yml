language: node_js
node_js:
  - "4"

env:
  global:
  - CXX=g++-4.8
  - DEPLOY_BRANCH=master
  - secure: "Wu9IrVZ6zo1BNXPq3iTLuwIvbX7k0fMgnv6ik+xDWwL05XoWsMgl/OUyp7T/G/wPlfYRWoxQsic9Zaajhn4g91bkAUwQKc07W2mBmsPLYRbTq4s1YAS9XygLRPH0ngtBThOgZsxyf0psD/ebQ+PMg2maqeZdWgwt2uDtJNT/u62cbIsjR7UZWZfVgvVhedARK5w6jPq3dCBP3PItTZMtaeeUuIxg1pxGC5tLcY3Qn2uR8+OcIKxGNa/2Vd+xJxGbpKQgud3Od1rg6FSaq7d5qsFPCAWVn0wClEw2XFbuQfYeQE/XmZ99U8dDRfqzNmXg8lVngL6KzhtdnUhOCYX6BPKU9K5B7XeVod/0FgrMDwlA5Tpo0PlVlXmTDayLCc+xPs/9yUFu18YfgYLEqdhDCur+IgLVNZ8+2Y+CL0JdzlWZzQ0fM+3BKXM2sWfa/5hSZGl57+1WqiyYg7e+7xWYvRSVpkK866MLA7VRsFYPPa3X+yE1tkucz6aRsQNbV4VsDfeFgDkho5kbFNL6k3Lu7ghKQw9CAECXvhiXjC7eNTu9EBN47a1ALoS+p/abpBfMjX+GdgSYOGmSvTESUhaUS5dNkrQcGB6uxGlt0mo+Bg8LrEUCSE3OOfhDDaBff/3Mw3hsp/uhQmvE1wZ4aQsaQuvrMKuUBGoXhCh8QTLVX3A=" # GH_TOKEN

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-4.8

cache:
  apt: true
  directories:
    - node_modules

before_install:
- chmod +x ./.build_scripts/deploy.sh
- chmod +x ./.build_scripts/lint.sh

before_script:
- ./.build_scripts/lint.sh
- npm test

script:
- NODE_ENV=production npm run build

deploy:
  provider: script
  skip_cleanup: true
  script: .build_scripts/deploy.sh
  on:
    branch: ${DEPLOY_BRANCH}
